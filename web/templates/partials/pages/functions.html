<section class="mb-10">
  <h1 class="text-3xl md:text-4xl font-bold tracking-tight">
    Functions
  </h1>
</section>

<!-- 8.1 Function Definition -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Function Definition</h2>
  <p class="mt-2 text-lg text-gray-300">
    Functions package a sequence of statements behind a single name.
    They let you give a descriptive label to a piece of logic so it can
    be reused without copying and pasting code.
  </p>

  <div class="mt-4 rounded-2xl border border-gray-800 bg-gray-950 overflow-hidden">
    <div class="px-5 py-3 border-b border-gray-800 flex items-center justify-between">
      <div class="text-sm text-gray-300 font-medium">define_func.ego</div>
      <div class="text-xs text-gray-500">example</div>
    </div>
    <pre class="p-5 text-base overflow-x-auto"><code class="text-gray-200"><span class="operator">:</span><span class="function">greet</span> <span class="variable">name</span>
  <span class="variable">msg</span> <span class="operator">:=</span> <span class="string">'hello, '</span> <span class="operator">+</span> <span class="variable">name</span>
  <span class="keyword">ret</span> <span class="variable">msg</span>
<span class="operator">;</span>

<span class="operator">:</span><span class="function">add</span> <span class="variable">a</span>, <span class="variable">b</span>
  <span class="keyword">ret</span> <span class="variable">a</span> <span class="operator">+</span> <span class="variable">b</span>
<span class="operator">;</span>

<span class="comment"># implicit return value</span>
<span class="operator">:</span><span class="function">isEqual</span> <span class="variable">x</span>, <span class="variable">y</span>
  <span class="variable">x</span> <span class="operator">==</span> <span class="variable">y</span>
<span class="operator">;</span></code></pre>
  </div>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Syntax.</span>
      A function starts with the <code class="text-gray-200">:</code>
      keyword, followed by a name, a comma-separated
      parameter list, and then a block of statements. Parentheses are not allowed
      around the parameter list. 
    </div>

    <div>
      <span class="font-semibold">Parameters.</span>
      Parameter names behave like local variables that are initialized
      from the arguments at call time. Inside the function body, you
      read and assign them just like any other variable.
    </div>

    <div>
      <span class="font-semibold">Block structure.</span>
      Function bodies follow the same rules as other multi-line
      constructs in Ego: the body is indented under the definition line
      and the block is closed by a final line ending with
      <code class="text-gray-200">;</code>.
    </div>

    <div>
      <span class="font-semibold">Return values.</span>
      The <code class="text-gray-200">ret</code> statement immediately
      stops executing the function and produces its value. If control
      reaches the end of the function body without a
      <code class="text-gray-200">ret</code>, the value of the last
      expression in the body is returned implicitly. If there is no
      such expression, the function returns
      <code class="text-gray-200">nil</code> by default.
    </div>
  </div>
  </div>
</section>

<!-- 8.2 Function Literals -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Function Literals</h2>
  <p class="mt-2 text-lg text-gray-300">
    In addition to named functions, Ego supports function literals. These let you create a function
    value inline and store it in a variable or pass it around.
  </p>

  <div class="mt-4 rounded-2xl border border-gray-800 bg-gray-950 overflow-hidden">
    <div class="px-5 py-3 border-b border-gray-800 flex items-center justify-between">
      <div class="text-sm text-gray-300 font-medium">anon_func.ego</div>
      <div class="text-xs text-gray-500">example</div>
    </div>
    <pre class="p-5 text-base overflow-x-auto"><code class="text-gray-200"><span class="variable">add1</span> <span class="operator">:&gt;</span> <span class="variable">x</span>, <span class="variable">y</span>
  <span class="comment"># function body</span>
  <span class="keyword">ret</span> <span class="variable">x</span> <span class="operator">+</span> <span class="variable">y</span>
<span class="operator">;</span>

<span class="variable">add2</span> <span class="operator">:=</span> <span class="variable">add1</span>
<span class="function">put</span>(<span class="variable">add2</span>(<span class="number">3</span>, <span class="number">4</span>))  <span class="comment"># prints 7</span>

<span class="operator">:</span><span class="function">closure</span> <span class="variable">x</span>
  <span class="comment"># inner function literal that closes over x</span>
  <span class="variable">inner</span> <span class="operator">:&gt;</span> <span class="variable">y</span>
    <span class="keyword">ret</span> <span class="variable">x</span> <span class="operator">+</span> <span class="variable">y</span>
  <span class="operator">;</span>

  <span class="keyword">ret</span> <span class="variable">inner</span>
<span class="operator">;</span>

<span class="variable">adder</span> <span class="operator">:=</span> <span class="function">closure</span>(<span class="number">10</span>)
<span class="function">put</span>(<span class="variable">adder</span>(<span class="number">5</span>))  <span class="comment"># prints 15</span></code></pre>
  </div>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Function literal syntax.</span>
      The operator <code class="text-gray-200">:&gt;</code> introduces
      a function literal. The parameters and body look like a normal
      function, but the function itself has no name and is instead a
      value you can assign or pass around.
    </div>

    <div>
      <span class="font-semibold">Assigning to variables.</span>
      In the first example, the variable
      <code class="text-gray-200">add1</code> is bound to a
      function literal, and <code class="text-gray-200">add2</code>
      is another variable that refers to the same function. You can
      call it just like any named function:
      <code class="text-gray-200">add2(3, 4)</code>.
    </div>

    <div>
      <span class="font-semibold">Closures.</span>
      Function literals can capture variables from the surrounding
      scope. In the <code class="text-gray-200">closure</code> example,
      the inner function uses <code class="text-gray-200">x</code>
      from the outer scope, so the returned function "remembers" the
      value of <code class="text-gray-200">x</code> each time it is
      called.
    </div>
  </div>
</section>

<!-- 8.3 Function Calls -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Function Calls</h2>
  <p class="mt-2 text-lg text-gray-300">
    Calling a function evaluates its body with a particular set of
    argument values. The result of the last
    <code class="text-gray-200">ret</code> is the value of the call
    expression.
  </p>

  <div class="mt-4 rounded-2xl border border-gray-800 bg-gray-950 overflow-hidden">
    <div class="px-5 py-3 border-b border-gray-800 flex items-center justify-between">
      <div class="text-sm text-gray-300 font-medium">call_fn.ego</div>
      <div class="text-xs text-gray-500">example</div>
    </div>
    <pre class="p-5 text-base overflow-x-auto"><code class="text-gray-200"><span class="operator">:</span><span class="function">square</span> <span class="variable">x</span>
  <span class="keyword">ret</span> <span class="variable">x</span> <span class="operator">*</span> <span class="variable">x</span>
<span class="operator">;</span>

<span class="operator">:</span><span class="function">hypotenuse</span> <span class="variable">a</span>, <span class="variable">b</span>
  <span class="comment"># nested calls</span>
  <span class="keyword">ret</span> <span class="function">square</span>(<span class="variable">a</span>) <span class="operator">+</span> <span class="function">square</span>(<span class="variable">b</span>)
<span class="operator">;</span>

<span class="variable">result</span> <span class="operator">:=</span> <span class="function">hypotenuse</span>(<span class="number">3</span>, <span class="number">4</span>)
<span class="function">put</span>(<span class="string">'result = '</span> <span class="operator">+</span> <span class="function">str</span>(<span class="variable">result</span>))</code></pre>
  </div>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Argument passing.</span>
      When you call a function, Ego first evaluates each argument
      expression and then assigns those values to the corresponding
      parameters inside the callee.
    </div>

    <div>
      <span class="font-semibold">Evaluation order.</span>
      Arguments are evaluated before the function body runs, so any
      side effects they have (such as <code class="text-gray-200">put</code>
      calls or assignments) happen before entering the function.
    </div>

    <div>
      <span class="font-semibold">Side effects.</span>
      Functions may return values, perform side effects like printing,
      or both. A call expression can be used as a standalone statement
      (for its effects) or as part of a larger expression.
    </div>
  </div>
</section>

<!-- 8.4 Arguments -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Arguments</h2>
  <p class="mt-2 text-lg text-gray-300">
    Ego uses simple positional arguments for function calls, plus a
    small set of special variables for script-level parameters.
  </p>

  <div class="mt-4 rounded-2xl border border-gray-800 bg-gray-950 overflow-hidden">
    <div class="px-5 py-3 border-b border-gray-800 flex items-center justify-between">
      <div class="text-sm text-gray-300 font-medium">args.ego</div>
      <div class="text-xs text-gray-500">example</div>
    </div>
    <pre class="p-5 text-base overflow-x-auto"><code class="text-gray-200"><span class="operator">:</span><span class="function">repeat</span> <span class="variable">msg</span>, <span class="variable">times</span>
  <span class="variable">i</span> <span class="operator">:=</span> <span class="number">0</span>
  <span class="keyword">for</span> <span class="variable">i</span> <span class="operator">&lt;</span> <span class="variable">times</span>
    <span class="function">put</span>(<span class="variable">msg</span>)
    <span class="variable">i</span> <span class="operator">=</span> <span class="variable">i</span> <span class="operator">+</span> <span class="number">1</span>
  <span class="operator">;</span>
<span class="operator">;</span>

<span class="function">repeat</span>(<span class="string">'hi'</span>, <span class="number">3</span>)

<span class="operator">:</span><span class="function">show_script_args</span>
  <span class="function">put</span>(<span class="string">'script name: '</span> <span class="operator">+</span> <span class="variable">$0</span>)
  <span class="function">put</span>(<span class="string">'first arg: '</span> <span class="operator">+</span> <span class="variable">$1</span>)
  <span class="function">put</span>(<span class="string">'second arg: '</span> <span class="operator">+</span> <span class="variable">$2</span>)
<span class="operator">;</span></code></pre>
  </div>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Positional arguments.</span>
      Arguments are matched to parameters by position only. The first
      argument initializes the first parameter, the second argument the
      second parameter, and so on.
    </div>

    <div>
      <span class="font-semibold">Special args.</span>
      The identifiers <code class="text-gray-200">$0</code>,
      <code class="text-gray-200">$1</code>,
      <code class="text-gray-200">$2</code>, and so on are reserved for
      script-level positional parameters. Typically
      <code class="text-gray-200">$0</code> holds the script name and
      <code class="text-gray-200">$1</code> and above hold values
      passed on the command line. Script arguments are read-only and
      cannot be assigned to. They will always be strings.
    </div>

    <div>
      <span class="font-semibold">Argument count behavior.</span>
      A call must supply exactly as many arguments as there are
      parameters. Supplying too few or too many arguments is reported as
      an error rather than silently guessing what you meant.
    </div>
  </div>
</section>

<!-- Navigation: Previous / Next -->
<section class="mt-12 pt-8 border-t border-gray-800 flex flex-col items-center text-center text-base gap-3">
  <div class="flex flex-col sm:flex-row gap-3">
    <button
      type="button"
      onclick="document.getElementById('link-control')?.click()"
      class="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 bg-gray-900 text-gray-200 border border-gray-700 hover:bg-gray-800 cursor-pointer w-full sm:w-auto"
    >
      <span aria-hidden="true">&larr;</span>
      <span class="font-medium">Control Flow</span>
    </button>

    <button
      type="button"
      onclick="document.getElementById('link-structures')?.click()"
      class="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 bg-gray-800 text-gray-100 hover:bg-gray-700 cursor-pointer w-full sm:w-auto"
    >
      <span class="font-medium">Data Structures</span>
      <span aria-hidden="true">&rarr;</span>
    </button>
  </div>
</section>