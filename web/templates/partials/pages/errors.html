<section class="mb-10">
  <h1 class="text-3xl md:text-4xl font-bold tracking-tight">
    Errors and Diagnostics
  </h1>
  <p class="mt-3 text-lg text-gray-300 max-w-2xl">
    Errors in Ego are designed for trust and debuggability: they are
    explicit objects you can inspect, print, and pass around, and the
    interpreter reports precise locations to help you fix problems quickly.
  </p>
</section>

<!-- Error Types -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Error Types</h2>
  <p class="mt-2 text-lg text-gray-300">
    Ego currently distinguishes between parser errors (before your
    program runs) and runtime errors (while your program is executing).
  </p>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Parser errors.</span>
      These happen when the source text is not valid Ego code. Examples
      include missing block terminators, unmatched brackets, or using
      reserved words in the wrong place. The program does <em>not</em>
      start running until all parser errors are fixed.
    </div>

    <div>
      <span class="font-semibold">Runtime errors.</span>
      These occur after parsing succeeds, while executing your program.
      Examples include indexing past the end of an array, accessing a key
      that does not exist in a map, or calling a function with the wrong
      number or type of arguments.
    </div>

    <div>
      <span class="font-semibold">Error objects.</span>
      At runtime, errors are implemented as maps with three keys:
      <code class="text-gray-200">'message'</code>,
      <code class="text-gray-200">'line'</code>, and
      <code class="text-gray-200">'column'</code>. Built-in errors fill in all
      three fields for you, and when you create your own errors you
      control the <code class="text-gray-200">'message'</code> while Ego
      still records where the error came from via
      <code class="text-gray-200">'line'</code> and
      <code class="text-gray-200">'column'</code>.
    </div>
  </div>
</section>

<!-- Error Behavior and Reporting -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Error Behavior</h2>
  <p class="mt-2 text-lg text-gray-300">
    When an error occurs, Ego either halts execution and reports a
    diagnostic, or—in many cases—lets you catch and handle the error
    yourself using the <code class="text-gray-200">else</code> clause
    and the built-in error value <code class="text-gray-200">$e</code>.
  </p>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">When execution halts.</span>
      Unhandled runtime errors cause the current program to stop. The
      interpreter prints a message describing what went wrong along with
      the file, line, and column where the error was raised.
    </div>

    <div>
      <span class="font-semibold">Error messages.</span>
      Error messages aim to be human-readable first, describing the kind
      of failure (for example, &ldquo;index out of range&rdquo; or
      &ldquo;key not found&rdquo;) and including any relevant dynamic
      values.
    </div>

    <div>
      <span class="font-semibold">Line and column reporting.</span>
      Both parser and runtime errors report where they occurred. For
      multi-line constructs, the location typically points to the
      expression or statement that triggered the error, not just the
      start of the block.
    </div>
  </div>
</section>

<!-- Handling Errors with else -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Handling Errors with <code class="text-gray-200">else</code></h2>
  <p class="mt-2 text-lg text-gray-300">
    Many operations that can fail support an inline
    <code class="text-gray-200">else</code> clause for error handling.
    If the operation succeeds, its value is returned. If it fails, the
    <code class="text-gray-200">else</code> branch runs instead. The
    built-in constant <code class="text-gray-200">$e</code> (also
    referred to as <span class="font-mono">const E</span>) represents a
    generic error object you can return from functions.
  </p>

  <div class="mt-4 rounded-2xl border border-gray-800 bg-gray-950 overflow-hidden">
    <div class="px-5 py-3 border-b border-gray-800 flex items-center justify-between">
      <div class="text-sm text-gray-300 font-medium">inline-error-handling.ego</div>
      <div class="text-xs text-gray-500">example</div>
    </div>
    <pre class="p-5 text-base overflow-x-auto"><code class="text-gray-200"><span class="variable">a</span> <span class="operator">:=</span> <span class="operator">[</span><span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span><span class="operator">]</span>

<span class="comment"># inline error handling with else clause</span>
<span class="variable">val</span> <span class="operator">:=</span> <span class="variable">a</span><span class="operator">[</span><span class="number">3</span><span class="operator">]</span> <span class="keyword">else</span>
  <span class="function">put</span>(<span class="string">'There was an error accessing the array...'</span>)
  <span class="keyword">ret</span> <span class="keyword">nil</span>
<span class="operator">;</span>


<span class="comment"># return built-in error value</span>
<span class="operator">:</span><span class="function">get</span> <span class="variable">arr</span>, <span class="variable">index</span>
  <span class="keyword">ret</span> <span class="variable">arr</span><span class="operator">[</span><span class="variable">index</span><span class="operator">]</span> <span class="keyword">else</span> <span class="variable">$e</span>
<span class="operator">;</span>


<span class="variable">b</span> <span class="operator">:=</span> <span class="function">get</span>(<span class="variable">a</span>, <span class="number">3</span>)

<span class="comment"># check if function returned an error object</span>
<span class="keyword">if</span> !<span class="function">ok</span>(<span class="variable">b</span>)
  <span class="function">put</span>(<span class="variable">b</span><span class="operator">[</span><span class="string">'message'</span><span class="operator">]</span>)
  <span class="function">put</span>(<span class="variable">b</span><span class="operator">[</span><span class="string">'line'</span><span class="operator">]</span>)
  <span class="function">put</span>(<span class="variable">b</span><span class="operator">[</span><span class="string">'column'</span><span class="operator">]</span>)
<span class="keyword">else</span>
  <span class="function">put</span>(<span class="string">'Value: '</span> <span class="operator">+</span> <span class="variable">b</span>)
<span class="operator">;</span></code></pre>
  </div>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Inline handling.</span>
      In the first example, the array access <code class="text-gray-200">a[3]</code>
      will fail because the index is out of range. Instead of crashing,
      the <code class="text-gray-200">else</code> block runs, prints a
      message, and returns <code class="text-gray-200">nil</code> from
      the surrounding function or script.
    </div>

    <div>
      <span class="font-semibold">Returning <code class="text-gray-200">$e</code>.</span>
      The <code class="text-gray-200">get</code> function uses
      <code class="text-gray-200">ret arr[index] else $e</code> to
      return either the value at <code class="text-gray-200">index</code>
      or, on failure, the built-in error object <code class="text-gray-200">$e</code>.
      This is a common pattern for propagating errors to callers.
    </div>

    <div>
      <span class="font-semibold">Detecting errors.</span>
      The <code class="text-gray-200">ok(x)</code> predicate returns
      <code class="text-gray-200">true</code> when <code class="text-gray-200">x</code>
      is <em>not</em> an error and <code class="text-gray-200">false</code>
      when it is. Callers can branch on this to decide whether to show an
      error message (such as <code class="text-gray-200">b['message']</code>)
      or proceed with a successful value.
    </div>
  </div>
</section>

<!-- Creating Custom Errors -->
<section class="mb-10">
  <h2 class="text-2xl font-bold">Creating Your Own Errors</h2>
  <p class="mt-2 text-lg text-gray-300">
    In addition to using the built-in <code class="text-gray-200">$e</code>,
    you can create your own error objects with the
    <code class="text-gray-200">error(message)</code> builtin. These errors
    behave like any other error value in Ego: they are maps with
    <code class="text-gray-200">'message'</code>,
    <code class="text-gray-200">'line'</code>, and
    <code class="text-gray-200">'column'</code> keys, though
    <code class="text-gray-200">error(message)</code> only lets you set the
    <code class="text-gray-200">'message'</code> and the runtime fills in the
    location. You can still check them with
    <code class="text-gray-200">ok(x)</code>.
  </p>

  <div class="mt-4 rounded-2xl border border-gray-800 bg-gray-950 overflow-hidden">
    <div class="px-5 py-3 border-b border-gray-800 flex items-center justify-between">
      <div class="text-sm text-gray-300 font-medium">custom-errors.ego</div>
      <div class="text-xs text-gray-500">example</div>
    </div>
    <pre class="p-5 text-base overflow-x-auto"><code class="text-gray-200"><span class="operator">:</span><span class="function">getCmd</span>
  <span class="variable">cmd</span> <span class="operator">:=</span> <span class="function">input</span>(<span class="string">'Enter a command: '</span>)

  <span class="keyword">if</span> <span class="variable">cmd</span> <span class="operator">==</span> <span class="string">''</span>
    <span class="keyword">ret</span> <span class="function">error</span>(<span class="string">'No command was entered'</span>)
  <span class="operator">;</span>

  <span class="keyword">ret</span> <span class="variable">cmd</span>
<span class="operator">;</span>

<span class="variable">cmd</span> <span class="operator">:=</span> <span class="function">getCmd</span>()

<span class="keyword">if</span> !<span class="function">ok</span>(<span class="variable">cmd</span>)
  <span class="function">put</span>(<span class="string">'Error: '</span> <span class="operator">+</span> <span class="variable">cmd</span><span class="operator">[</span><span class="string">'message'</span><span class="operator">]</span>)
<span class="keyword">else</span>
  <span class="function">put</span>(<span class="variable">cmd</span>)
<span class="operator">;</span></code></pre>
  </div>

  <div class="mt-4 space-y-3 text-base text-gray-300">
    <div>
      <span class="font-semibold">Raising custom errors.</span>
      The <code class="text-gray-200">getCmd</code> function calls
      <code class="text-gray-200">error('No command was entered')</code>
      when the user submits an empty command. This produces an error
      object with a <code class="text-gray-200">'message'</code> that
      can be inspected later.
    </div>

    <div>
      <span class="font-semibold">Checking with <code class="text-gray-200">ok</code>.</span>
      After calling <code class="text-gray-200">getCmd()</code>, the code
      uses <code class="text-gray-200">if !ok(cmd)</code> to see whether
      an error was returned. If so, it prints the error message; otherwise,
      it proceeds with the successful command value.
    </div>
  </div>
</section>

<!-- Navigation: Previous / Next -->
<section class="mt-12 pt-8 border-t border-gray-800 flex flex-col items-center text-center text-base gap-3">
  <div class="flex flex-col sm:flex-row gap-3">
    <button
      type="button"
      onclick="document.getElementById('link-scope')?.click()"
      class="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 bg-gray-900 text-gray-200 border border-gray-700 hover:bg-gray-800 cursor-pointer w-full sm:w-auto"
    >
      <span aria-hidden="true">&larr;</span>
      <span class="font-medium">Scope and Lifetime</span>
    </button>

    <button
      type="button"
      onclick="document.getElementById('link-builtins')?.click()"
      class="inline-flex items-center justify-center gap-2 rounded-lg px-4 py-2 bg-gray-800 text-gray-100 hover:bg-gray-700 cursor-pointer w-full sm:w-auto"
    >
      <span class="font-medium">Built-in Functions</span>
      <span aria-hidden="true">&rarr;</span>
    </button>
  </div>
</section>
